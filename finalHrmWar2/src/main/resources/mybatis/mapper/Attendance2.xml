<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hrm.finalpj.dao.IAttendanceDao2">
	<select id="todayWork" resultType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT E.EMPLOYEE_NAME,J.JOB_NAME,T.TYPE_CATEGORY,S.SCHEDULE_NAME,A.ATTENDANCE_WORKSTART,A.ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=1
		AND A.ATTENDANCE_WORKSTART IS NOT NULL
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,8) = TO_CHAR(SYSDATE)
	</select>
	<select id="todayWorkCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) AS TODAYWORKCOUNT
		FROM EMPLOYEE E, CALENDAR C, SCHEDULE S, ATTENDANCE A
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND E.EMPLOYEE_NUM=A.EMPLOYEE_NUM
		AND S.SCHEDULE_NUM=1
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,8) = TO_CHAR(SYSDATE)
	</select>
	<select id="beforeWorkCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(DISTINCT E.EMPLOYEE_NAME)
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J,
		    (SELECT B_ENUM EMPLOYEE_NUM
		    FROM (SELECT ATTENDANCE_WORKSTART,EMPLOYEE_NUM A_ENUM,TYPE_NUM FROM ATTENDANCE WHERE SUBSTR(ATTENDANCE_WORKSTART,1,8)=TO_CHAR(SYSDATE)) A,
		        (SELECT EMPLOYEE_NUM B_ENUM,SCHEDULE_NUM,CALENDAR_DATE FROM CALENDAR WHERE CALENDAR_DATE=TO_CHAR(SYSDATE)) B
		    WHERE A.A_ENUM(+) = B.B_ENUM AND B.SCHEDULE_NUM = 1
		    AND A.ATTENDANCE_WORKSTART IS NULL) MC
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND E.EMPLOYEE_NUM=MC.EMPLOYEE_NUM
	</select>
	<select id="notWorkCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(E.EMPLOYEE_NAME)
		FROM EMPLOYEE E,DEPARTMENT D,JOB J,CALENDAR C,SCHEDULE S
		WHERE J.JOB_NUM=D.JOB_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND S.SCHEDULE_NUM!=1
	</select>
	<select id="scheduleWorkCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) AS SCHEDULEWORKCOUNT
		FROM EMPLOYEE E, CALENDAR C, SCHEDULE S
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND C.SCHEDULE_NUM=1
		AND C.CALENDAR_DATE = TO_CHAR(SYSDATE)
	</select>
	<select id="lateWorkCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
	<![CDATA[
		SELECT COUNT(*) FROM
		(SELECT DISTINCT E.EMPLOYEE_NAME,J.JOB_NAME,'출근전' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J,
		    (SELECT B_ENUM EMPLOYEE_NUM
		    FROM (SELECT ATTENDANCE_WORKSTART,EMPLOYEE_NUM A_ENUM,TYPE_NUM FROM ATTENDANCE WHERE SUBSTR(ATTENDANCE_WORKSTART,1,8)=TO_CHAR(SYSDATE)) A,
		        (SELECT EMPLOYEE_NUM B_ENUM,SCHEDULE_NUM,CALENDAR_DATE FROM CALENDAR WHERE CALENDAR_DATE=TO_CHAR(SYSDATE)) B
		    WHERE A.A_ENUM(+) = B.B_ENUM AND B.SCHEDULE_NUM = 1
		    AND A.ATTENDANCE_WORKSTART IS NULL) MC
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND E.EMPLOYEE_NUM=MC.EMPLOYEE_NUM
		AND TO_CHAR(SYSDATE||' 09:30:00')<TO_CHAR(SYSDATE,'yy/mm/dd HH24:MI:SS'))
	]]>	
	</select>
	<select id="leftEarlierCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT E.EMPLOYEE_NAME,J.JOB_NAME,T.TYPE_CATEGORY,S.SCHEDULE_NAME,A.ATTENDANCE_WORKSTART,A.ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=1
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,8)=TO_CHAR(SYSDATE)
		AND TO_CHAR(SYSDATE||' 18:30:00')>A.ATTENDANCE_WORKEND)
	</select>
	<select id="businessTripCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT DISTINCT E.EMPLOYEE_NAME,J.JOB_NAME,'출장' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=2
		AND C.CALENDAR_DATE=TO_CHAR(SYSDATE))
	</select>
	<select id="vacationCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT DISTINCT E.EMPLOYEE_NAME,J.JOB_NAME,'휴가' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=3
		AND C.CALENDAR_DATE=TO_CHAR(SYSDATE))
	</select>
	<select id="educationCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT E.EMPLOYEE_NAME,J.JOB_NAME,'교육' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=4
		AND C.CALENDAR_DATE=TO_CHAR(SYSDATE))
	</select>
	<select id="etcCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT E.EMPLOYEE_NAME,J.JOB_NAME,'일정없음' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=6
		AND C.CALENDAR_DATE=TO_CHAR(SYSDATE))
	</select>
	<select id="noScheduleCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT E.EMPLOYEE_NAME,J.JOB_NAME,'일정없음' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=6
		AND C.CALENDAR_DATE=TO_CHAR(SYSDATE))
	</select>
	<select id="defaultCount" resultType="int" parameterType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT COUNT(*) FROM
		(SELECT E.EMPLOYEE_NAME,J.JOB_NAME,S.SCHEDULE_NAME TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,DEPARTMENT D,JOB J,CALENDAR C,SCHEDULE S
		WHERE J.JOB_NUM=D.JOB_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND S.SCHEDULE_NUM!=1
		UNION
		SELECT E.EMPLOYEE_NAME,J.JOB_NAME,T.TYPE_CATEGORY,S.SCHEDULE_NAME,A.ATTENDANCE_WORKSTART,A.ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=1
		AND A.ATTENDANCE_WORKSTART IS NOT NULL
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,8) = TO_CHAR(SYSDATE)
		UNION
		SELECT DISTINCT E.EMPLOYEE_NAME,J.JOB_NAME,'출근전' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J,
		    (SELECT B_ENUM EMPLOYEE_NUM
		    FROM (SELECT ATTENDANCE_WORKSTART,EMPLOYEE_NUM A_ENUM,TYPE_NUM FROM ATTENDANCE WHERE SUBSTR(ATTENDANCE_WORKSTART,1,8)=TO_CHAR(SYSDATE)) A,
		        (SELECT EMPLOYEE_NUM B_ENUM,SCHEDULE_NUM,CALENDAR_DATE FROM CALENDAR WHERE CALENDAR_DATE=TO_CHAR(SYSDATE)) B
		    WHERE A.A_ENUM(+) = B.B_ENUM AND B.SCHEDULE_NUM = 1
		    AND A.ATTENDANCE_WORKSTART IS NULL) MC
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND E.EMPLOYEE_NUM=MC.EMPLOYEE_NUM)
	</select>
	<select id="defaultList" resultType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT E.EMPLOYEE_NAME,J.JOB_NAME,S.SCHEDULE_NAME TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM EMPLOYEE E,DEPARTMENT D,JOB J,CALENDAR C,SCHEDULE S
		WHERE J.JOB_NUM=D.JOB_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND S.SCHEDULE_NUM!=1
		UNION
		SELECT E.EMPLOYEE_NAME,J.JOB_NAME,T.TYPE_CATEGORY,S.SCHEDULE_NAME,A.ATTENDANCE_WORKSTART,A.ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND C.SCHEDULE_NUM=1
		AND A.ATTENDANCE_WORKSTART IS NOT NULL
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,8) = TO_CHAR(SYSDATE)
		UNION
		SELECT DISTINCT E.EMPLOYEE_NAME,J.JOB_NAME,'출근전' TYPE_CATEGORY,S.SCHEDULE_NAME,'-' ATTENDANCE_WORKSTART,'-' ATTENDANCE_WORKEND
		FROM TYPE T,ATTENDANCE A,EMPLOYEE E,CALENDAR C,SCHEDULE S,DEPARTMENT D,JOB J,
		    (SELECT B_ENUM EMPLOYEE_NUM
		    FROM (SELECT ATTENDANCE_WORKSTART,EMPLOYEE_NUM A_ENUM,TYPE_NUM FROM ATTENDANCE WHERE SUBSTR(ATTENDANCE_WORKSTART,1,8)=TO_CHAR(SYSDATE)) A,
		        (SELECT EMPLOYEE_NUM B_ENUM,SCHEDULE_NUM,CALENDAR_DATE FROM CALENDAR WHERE CALENDAR_DATE=TO_CHAR(SYSDATE)) B
		    WHERE A.A_ENUM(+) = B.B_ENUM AND B.SCHEDULE_NUM = 1
		    AND A.ATTENDANCE_WORKSTART IS NULL) MC
		WHERE T.TYPE_NUM=A.TYPE_NUM
		AND A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND E.EMPLOYEE_NUM=MC.EMPLOYEE_NUM
	</select>

<!-- 	<select id="alreadyAtt" resultType="com.hrm.finalpj.dto.AttendanceDto2">
		SELECT E.EMPLOYEE_NAME,J.JOB_NAME,T.TYPE_CATEGORY, S.SCHEDULE_NAME,A.ATTENDANCE_WORKSTART, A.ATTENDANCE_WORKEND
		FROM ATTENDANCE A,EMPLOYEE E, CALENDAR C, SCHEDULE S, TYPE T, DEPARTMENT D, JOB J
		WHERE A.EMPLOYEE_NUM=E.EMPLOYEE_NUM
		AND E.EMPLOYEE_NUM=C.EMPLOYEE_NUM
		AND C.SCHEDULE_NUM=S.SCHEDULE_NUM
		AND S.TYPE_NUM=T.TYPE_NUM
		AND D.DEPARTMENT_NUM=E.DEPARTMENT_NUM
		AND D.JOB_NUM=J.JOB_NUM
		AND S.SCHEDULE_NUM=1
		AND SUBSTR(A.ATTENDANCE_WORKSTART,1,10) = TO_CHAR(SYSDATE,'yyyy-mm-dd')
	</select> -->
	
<!-- 	<select id="beforeAtt" resultType="com.hrm.finalpj.dto.AttendanceDto2"> -->
		
<!-- 	</select> -->
</mapper>